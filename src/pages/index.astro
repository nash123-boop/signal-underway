---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("posts"))
  .sort((a, b) => b.data.publishDate.localeCompare(a.data.publishDate));

const hero = posts[0];
const rightRail = posts.slice(1, 4);
const latest = posts.slice(1, 9);

const coverOf = (p) => p?.data?.cover ?? "/og-default.png";
---

<BaseLayout title="The National Signal" description="Tracking patterns shaping what comes next.">
  <div class="home">
    <div class="hero">
      <div class="heroKicker">
        <span class="kickerPill">Signals</span>
        <span class="kickerPill">Quiet Power</span>
        <span class="kickerPill">What Moves Next</span>
      </div>

      <h1>{hero?.data?.title ?? "The pattern is the story."}</h1>
      <p>{hero?.data?.deck ?? "We track signals — publicly visible traces that hint at what’s forming."}</p>

      <div class="heroActions">
        {hero && <a class="btn primary" href={`/p/${hero.slug}`}>Read the signal</a>}
        <a class="btn" href="/latest">Browse latest</a>
      </div>
    </div>

    <div class="homeGrid">
      <section>
        <div class="sectionTitle">Latest</div>

        <div class="list">
          {latest.map((p) => (
            <a class="item" href={`/p/${p.slug}`}>
              <div class="itemInner">
                <div class="meta">
                  <span class="badge">{p.data.category}</span>
                  <span>{p.data.publishDate}</span>
                </div>
                <h3>{p.data.title}</h3>
                <p>{p.data.deck}</p>
              </div>

              <div class="thumb" aria-hidden="true">
                <img
                  src={coverOf(p)}
                  alt=""
                  loading="lazy"
                  decoding="async"
                />
              </div>
            </a>
          ))}
        </div>
      </section>

      <aside>
        <div class="sectionTitle">Watchlist</div>

        <div class="list">
          {rightRail.map((p) => (
            <a class="item railItem" href={`/p/${p.slug}`}>
              <div class="itemInner">
                <div class="meta">
                  <span class="badge">{p.data.category}</span>
                  <span>{p.data.publishDate}</span>
                </div>
                <h3>{p.data.title}</h3>
                <p>{p.data.deck}</p>
              </div>

              <div class="thumb railThumb" aria-hidden="true">
                <img
                  src={coverOf(p)}
                  alt=""
                  loading="lazy"
                  decoding="async"
                />
              </div>
            </a>
          ))}
        </div>

        <div class="hr"></div>

        <div class="callout">
          <strong>How to read this site:</strong> We publish <em>signals</em> — grounded patterns with open-ended implications.
          We don’t do breaking news. We show the trail.
        </div>
      </aside>
    </div>
  </div>
</BaseLayout>
